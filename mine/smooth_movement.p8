pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
char = {
 x=0,
 y=10,
 frame=1,
 speed=50,
 anim_speed=8,
 anim_frames={1,2},
 flip_x=false
}

panel_locations={
 [10]={[10]=true,[11]=true,[15]=true,[20]=true},
 [11]={[10]=true,[11]=true,[16]=true,[19]=true},
 [20]={[10]=true,[11]=true},
}

last_t=0

function draw_char(char,x,y)
 local f=char.anim_frames[
  1+(flr(char.frame) % #char.anim_frames)
 ]
 spr(f,x,y,1,1,char.flip_x)
end

function _init()
end

function _draw()
 cls()
 map(0,0,64-char.x,72-char.y)
 draw_panels()
 draw_char(char, 64, 64)
end

function draw_spr(s,x,y)
	spr(
	 s,
	 (8+x)*8-char.x,
	 (9+y)*8-char.y
	)
end

function panel_at(x,y)
 xp = panel_locations[x]
 return xp and xp[y]
end

function draw_panels()
 overlays={}
 for x,ys in pairs(panel_locations) do
  for y,t in pairs(ys) do
   -- draw overlays
   -- careful about leg length
   if panel_at(x+1,y+1) then
    if not overlays[x] then
     overlays[x] = {}
    end
    -- short legs override long
    if not overlays[x][y] then
     overlays[x][y]=1
    end
   end
   if panel_at(x+1,y-1) then
    if not overlays[x] then
     overlays[x] = {}
    end
    overlays[x][y-1]=2
   end
   draw_spr(17,x,y)
  end
 end
	for x,row in pairs(overlays) do
	 for y,v in pairs(row) do
 	 draw_spr(21,x,y)
 	 draw_spr(38,x+1,y+1)
 	 draw_spr(22,x+1,y)
 	 if v==1 then
  	 draw_spr(37,x,y+1) -- long leg
  	else
  	 draw_spr(53,x,y+1) -- short leg
  	end
  end
 end
end

function test_overlay(x,y) -- todo delete
 spr(21,x,y)
 spr(22,x+8,y)
 -- 53 short leg, 37 long leg
 spr(53,x,y+8)
 spr(38,x+8,y+8)
end

function _update60()
 ft=t()
 elapsed=ft-last_t
 last_t=ft
 max_skip_fps=15
 max_elapsed=1/max_skip_fps
 if elapsed>max_elapsed then
  -- make sure we don't skip
  -- physics too far if the
  -- game hiccups
  elapsed=max_elapsed
 end
 local x=0
 local y=0
 if btn(⬅️) then
  char.flip_x=true
  char.anim_frames={1,2}
  x=-1
 end
 if btn(➡️) then
  x=1
  char.anim_frames={1,2}
  char.flip_x=false
 end
 if btn(⬆️) then
  char.anim_frames={3,4}
  y=-1
  if btn(⬅️) or btn(➡️) then
   char.anim_frames={9,10}
  end
 end
 if btn(⬇️) then
  char.anim_frames={7,8}
  y=1
  if btn(⬅️) or btn(➡️) then
   char.anim_frames={5,6}
  end
 end
 if x!=0 or y!=0 then
	 -- normalize the movement vector
	 local len=sqrt(x^2+y^2)
	 x/=len
	 y/=len
	 x*=char.speed*elapsed
	 y*=char.speed*elapsed
	 char.x += x
	 char.y += y
	end
	if x+y != 0 then
		char.frame += char.anim_speed*elapsed
	else
	 char.frame = 0.99
	end
end
__gfx__
00000000000000000044440000000000004440000000000000444400000000000044400000000000004444000000000000000000000000000000000000000000
000000000044440000444f000044400004444400004444000044f40000444000044f440000444400044444000000000000000000000000000000000000000000
0070070000444f00044f1f0004444400044444000044f4000441f100044f4400041f14000444440004444f000000000000000000000000000000000000000000
00077000044f1f00044fff0004444400044444000441f100044fff00041f140004fff40004444f0004444f000000000000000000000000000000000000000000
00077000044fff0000eee0000444440000444000044fff0000eee00004fff40004eee40004444f000044e0000000000000000000000000000000000000000000
0070070000eee00000dfd0000044400000d4d00000eee00000fddf0004eee4000fdddf000044e000004ddf000000000000000000000000000000000000000000
0000000000fdd0000d000d0000d4d00000d0d00000fddf000d000d000fdddf0000d0d000004ddf000d000d000000000000000000000000000000000000000000
0000000000d0d0000000000000d0d0000000000000d0d0000000000000d0d0000000000000d0d000000000000000000000000000000000000000000000000000
33333333333733330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33b33333337c73b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
533333b337ccc7330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333533337cc7cc730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333b33337cc7cc70000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333317ccc730000000000000000000000000000007c70000000000000000000000000000000000000000000000000000000000000000000000000000000
b3333333b137c733000000000000000000000000000007ccc7000000000000000000000000000000000000000000000000000000000000000000000000000000
33533b333353733300000000000000000000000000007cc7cc700000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000007cc7cc70000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000017ccc700000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000107c7000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000007cc00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000017c00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
