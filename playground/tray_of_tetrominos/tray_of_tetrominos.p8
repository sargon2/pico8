pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
-- grid size
grid_w = 10
grid_h = 20

-- active piece number
piece = flr(rnd(7)+1)

-- active piece position
posx = 3
posy = 3

-- active piece rotation
rot = 0

-- each cell holds 0 (empty) or sprite index
grid = {}

shapes = {
 { -- i
  {{-1,0},{0,0},{1,0},{2,0}},
  {{0,-1},{0,0},{0,1},{0,2}},
  {{-1,0},{0,0},{1,0},{2,0}},
  {{0,-1},{0,0},{0,1},{0,2}},
 },
 { -- j
  {{-1,-1},{-1,0},{0,0},{1,0}},
  {{0,-1},{1,-1},{0,0},{0,1}},
  {{-1,0},{0,0},{1,0},{1,1}},
  {{0,-1},{0,0},{-1,1},{0,1}},
 },
 { -- l
  {{1,-1},{-1,0},{0,0},{1,0}},
  {{0,-1},{0,0},{0,1},{1,1}},
  {{-1,0},{0,0},{1,0},{-1,1}},
  {{-1,-1},{0,-1},{0,0},{0,1}}
 },
 { -- o
  {{0,-1},{1,-1},{0,0},{1,0}},
  {{0,-1},{1,-1},{0,0},{1,0}},
  {{0,-1},{1,-1},{0,0},{1,0}},
  {{0,-1},{1,-1},{0,0},{1,0}}
 },
 { -- s
  {{0,-1},{1,-1},{-1,0},{0,0}},
  {{0,-1},{0,0},{1,0},{1,1}},
  {{0,0},{1,0},{-1,1},{0,1}},
  {{-1,-1},{-1,0},{0,0},{0,1}}
 },
 { -- t
  {{0,-1},{-1,0},{0,0},{1,0}},
  {{0,-1},{0,0},{1,0},{0,1}},
  {{-1,0},{0,0},{1,0},{0,1}},
  {{0,-1},{-1,0},{0,0},{0,1}}
 },
 { -- z
  {{-1,-1},{0,-1},{0,0},{1,0}},
  {{1,-1},{0,0},{1,0},{0,1}},
  {{-1,0},{0,0},{0,1},{1,1}},
  {{0,-1},{-1,0},{0,0},{-1,1}}
 }
}

function init_grid()
	for x=1,grid_w do
  grid[x] = {}
  for y=1,grid_h do
   grid[x][y] = 0
  end
 end
end

function _init()
 init_grid()
end

function _update()
	if btnp(‚¨áÔ∏è) then
		posy += 1
	end
	if btnp(‚¨ÜÔ∏è) then
		posy -= 1
	end
	if btnp(‚¨ÖÔ∏è) then
		posx -= 1
	end
	if btnp(‚û°Ô∏è) then
		posx += 1
	end
	if btnp(‚ùé) then
		rot = (rot + 1) % 4
	end
	if btnp(üÖæÔ∏è) then
		drop()
	end
end

function _draw()
 cls()
  
 -- board
 for x=1,grid_w do
  for y=1,grid_h do
   local tile = grid[x][y]
   if tile ~= 0 then
    spr(tile, x*8, y*8)
   else
    rect(x*8, y*8, (x+1)*8-1, (y+1)*8-1, 5)
   end
  end
 end
  
 -- active piece
 for c in all(shapes[piece][rot+1]) do
 	spr(piece, (posx+c[1])*8, (posy+c[2])*8)
 end
end

function drop()
 for c in all(shapes[piece][rot+1]) do
  grid[posx+c[1]][posy+c[2]] = piece
 end
 piece = flr(rnd(7)+1)
end
__gfx__
000000005cccccc551111115599999955aaaaaa55bbbbbb552222225588888850000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc1111111199999999aaaaaaaabbbbbbbb22222222888888880000000000000000000000000000000000000000000000000000000000000000
00700700cccc77cc1111771199997799aaaa77aabbbb77bb22227722888877880000000000000000000000000000000000000000000000000000000000000000
00077000cccc77cc1111771199997799aaaa77aabbbb77bb22227722888877880000000000000000000000000000000000000000000000000000000000000000
00077000cccccccc1111111199999999aaaaaaaabbbbbbbb22222222888888880000000000000000000000000000000000000000000000000000000000000000
00700700cccccccc1111111199999999aaaaaaaabbbbbbbb22222222888888880000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc1111111199999999aaaaaaaabbbbbbbb22222222888888880000000000000000000000000000000000000000000000000000000000000000
000000005cccccc551111115599999955aaaaaa55bbbbbb552222225588888850000000000000000000000000000000000000000000000000000000000000000
